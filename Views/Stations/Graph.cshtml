@model ReliDemo.ViewModels.StationHistoriesViewModel

@{
    ViewBag.Title = "Graph";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row-fluid">
<div class="span8">
<p>
    @Html.ActionLink("返回热力站列表", "Paged")
</p>
</div>
</div>
<div class="row-fluid clearfix stationTitle">
    <h1 class="span3">@Model.StationName</h1>
    <div onDesktop="span4" onTablet="span6" onMobile="span12">@Html.Partial("_TopMenu")</div>
</div>
<div class="row-fluid stationControl">
    <div class="control-group"  onTablet="span12" onDesktop="span3" >
            <label class="checkbox inline">
                <input type="radio" value="week" name="week" /> 周
            </label>
            <label class="checkbox inline">
                <input type="radio" value="month" name="month"  /> 月
            </label>
            <label class="checkbox inline">
                <input type="radio" value="season" name="season"  /> 供暖季
            </label>
    </div>
    <div class="control-group"  onTablet="span12" onDesktop="span5" >
        <text>选择日期:</text>
        @Html.TextBox("dateFrom", DateTime.Today.AddDays(-7).ToString("yyyy-MM-dd"), new { @style="width:100px" })
        <text>到</text>
        @Html.TextBox("dateTo", DateTime.Today.AddDays(1).ToString("yyyy-MM-dd"), new { @style="width:100px" })
        <input type="submit" value="搜索" id="search" class="btn btn-primary" style="vertical-align: top;"/>
    </div>
	<div class="control-group"   onTablet="span12" onDesktop="span4" >
	<text>折合统一温度</text>
	<input type="text" class="inline" style="width:100px" /><text>℃</text></div>
</div>
<div class="row-fluid">
    <div id="placeholder" style="width:100%;height:400px">
    </div>
</div>
@Html.HiddenFor(model=>model.StationId)
<script type="text/javascript">

    $(function () {

        var options = {
            lines: {
                show: true
            },
            points: {
                show: true
            },
            xaxis: {
                mode: "time",
                minTickSize: [1, "day"],
                timeformat: "%m月%d日"
            }
        };

        $("#search").click(function () {

            var button = $(this);

            // Find the URL in the link right next to us, then fetch the data

            var dataurl = "HistoryData?stationId=" + $("#StationId").val() + "&from=" + $("#dateFrom").val() + "&to=" + $("#dateTo").val();

            function onDataReceived(series) {
				console.log(series);
                $.plot("#placeholder", [{"label":"计划单耗", "data": series.planned }, {"label":"实际单耗",  "data": series.actual }, {"label":"核算单耗",  "data": series.calculated}], options);
            }

            $.ajax({
                url: dataurl,
                type: "GET",
                dataType: "json",
                success: onDataReceived
            });
        });


        // Load the first series by default, so we don't have an empty plot

        $("#search").click();

        // Add the Flot version string to the footer

    });

	</script>