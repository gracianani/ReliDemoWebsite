@model ReliDemo.ViewModels.StationHistoriesViewModel

@{
    ViewBag.Title = "Graph";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row-fluid">
<div class="span8">
<p>
    @Html.ActionLink("返回热力站列表", "Paged")
</p>
</div>
<h2>@Model.StationName</h2>
<div class="span8">
    @Html.Partial("_TopMenu")
</div>
</div>
<div class="row-fluid">
    <div>
        <label for="week">周</label><input type="radio" value="week" name="week" />
        <label for="month">月</label> <input type="radio" value="month" name="month"  /> 
        <label for="season">供暖季</label><input type="radio" value="season" name="season"  /> 
    </div>
    <text>选择日期:</text>
    @Html.TextBox("dateFrom")
    <text>到</text>
    @Html.TextBox("dateTo")
    <input type="submit" value="搜索" id="search" class="btn btn-primary" style="vertical-align: top;"/>
</div>
<div class="row-fluid">
    <div id="placeholder" style="width:100%;height:400px">
    </div>
</div>
<script type="text/javascript">

    $(function () {

        var options = {
            lines: {
                show: true
            },
            points: {
                show: true
            },
            xaxis: {
                tickDecimals: 0,
                tickSize: 1
            }
        };

        var data = [];

        $.plot("#placeholder", data, options);

        // Fetch one series, adding to what we already have

        var alreadyFetched = {};

        $("#search").click(function () {

            var button = $(this);

            // Find the URL in the link right next to us, then fetch the data

            var dataurl = "HistoryData?stationId=1&from=2013-11-14&to=2013-11-16";

            function onDataReceived(series) {
                console.log(series);
                // Extract the first coordinate pair; jQuery has parsed it, so
                // the data is now just an ordinary JavaScript object

                var firstcoordinate = "(" + series.lilun[0][0] + ", " + series.lilun[0][1] + ")";
                button.siblings("span").text("Fetched " + series.label + ", first point: " + firstcoordinate);

                // Push the new data onto our existing data array
                data.push(series.lilun);
                /*if (!alreadyFetched[series.label]) {
                    alreadyFetched[series.label] = true;
                    data.push(series.lilun);
                }*/

                $.plot("#placeholder", [{ "data": series.lilun }, { "data": series.shiji}], options);
            }

            $.ajax({
                url: dataurl,
                type: "GET",
                dataType: "json",
                success: onDataReceived
            });
        });


        // Load the first series by default, so we don't have an empty plot

        $("#search").click();

        // Add the Flot version string to the footer

    });

	</script>