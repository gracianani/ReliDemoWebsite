@model  IEnumerable<ReliDemo.Models.ITemperatureGraphItem>


<div id="graph"  style="height:250px">
</div>

@Html.Hidden("forecastAverage", 
        "[" + string.Join(",", Model.Where(i=>i.ForcastAverage.HasValue).OrderBy(i=>i.日期).Select(i=> string.Format("{{\"time\": \"{0:yyyy-MM-dd HH:mm:ss}\", \"temperature\" : {1}}}", i.日期, i.ForcastAverage)).ToArray() ) + "]"
)
@Html.Hidden("forecastHighest",
                   "[" + string.Join(",", Model.Where(i => i.ForecastHighest.HasValue).Select(i => string.Format("{{\"time\": \"{0:yyyy-MM-dd HH:mm:ss}\", \"temperature\" : {1}}}", i.日期, i.ForecastHighest)).ToArray()) + "]"
)
@Html.Hidden("forecastLowest",
                           "[" + string.Join(",", Model.Where(i => i.ForecastLowest.HasValue).Select(i => string.Format("{{\"time\": \"{0:yyyy-MM-dd HH:mm:ss}\", \"temperature\" : {1}}}", i.日期, i.ForecastLowest)).ToArray()) + "]"
)
@Html.Hidden("actualAverage",
                               "[" + string.Join(",", Model.Where(i => i.ActualAverage.HasValue).Select(i => string.Format("{{\"time\": \"{0:yyyy-MM-dd HH:mm:ss}\", \"temperature\" : {1}}}", i.日期, i.ActualAverage)).ToArray()) + "]"
)

<script type="text/javascript">
    $(document).ready(function () {
        var forecastAverageData = $.parseJSON($("input[name=forecastAverage]").val());

        var forecastAverage = [];
        for (var i = 0; i < forecastAverageData.length; i++) {
            forecastAverage.push([(new Date(forecastAverageData[i].time).getTime()), forecastAverageData[i].temperature]);
        }

        var forecastHighestData = $.parseJSON($("input[name=forecastHighest]").val());
        var forecastHighest = [];
        for (var i = 0; i < forecastHighestData.length; i++) {
            forecastHighest.push([(new Date(forecastHighestData[i].time).getTime()), forecastHighestData[i].temperature]);
        }
        var forecastLowestData = $.parseJSON($("input[name=forecastLowest]").val());
        var forecastLowest = [];
        for (var i = 0; i < forecastLowestData.length; i++) {
            forecastLowest.push([(new Date(forecastLowestData[i].time).getTime()), forecastLowestData[i].temperature]);
        }
        var actualAverageData = $.parseJSON($("input[name=actualAverage]").val());
        var actualAverage = [];
        for (var i = 0; i < actualAverageData.length; i++) {
            actualAverage.push([(new Date(actualAverageData[i].time).getTime()), actualAverageData[i].temperature]);
        }
        var heatTempChartGrid = {
            tickColor: "#eee",
            borderWidth: 0,
            hoverable: true,
            clickable: true
        };

        var tempChartOptions = {
            xaxis: {
                mode: "time",
                minTickSize: [1, "day"],
                timeformat: "%m月%d日"
            },
            yaxis: {
                min: -20,
                max: 45
            },
            grid: heatTempChartGrid,
			colors:["#ec6313","#00558e"]
        };

        var temperatureChartData = [];
        temperatureChartData.push({
            label: "预报平均温度",
            data: forecastAverage,
            lines: { show: true },
            points: { show: true }
        });
        temperatureChartData.push({
            label: "预报最高温度",
            data: forecastHighest,
            lines: { show: true },
            points: { show: true }
        });
        temperatureChartData.push({
            label: "预报最低温度",
            data: forecastLowest,
            lines: { show: true },
            points: { show: true }
        });
        temperatureChartData.push({
            label: "实际平均温度",
            data: actualAverage,
            lines: { show: true },
            points: { show: true }
        });
        var dashboardHeatTempChart = $.plot($("#graph"), temperatureChartData, tempChartOptions);

        var points = dashboardHeatTempChart.getData();
        var graphx = $('#graph').offset().left;
        graphx = graphx + 30; // replace with offset of canvas on graph
        var graphy = $('#graph').offset().top;
        graphy = graphy + 10; // how low you want the label to hang underneath the point
        for (var k = 0; k < points.length; k++) {
            for (var m = 0; m < points[k].data.length; m++) {
                if (points[k].data[m][0] != null && points[k].data[m][1] != null) {
                    if (k == 0) {
                        showTooltip(graphx + points[k].xaxis.p2c(points[k].data[m][0]), graphy + points[k].yaxis.p2c(points[k].data[m][1]) - 40, points[k].data[m][1], "#ec6313")
                    } else {
                        showTooltip(graphx + points[k].xaxis.p2c(points[k].data[m][0]), graphy + points[k].yaxis.p2c(points[k].data[m][1]) + 5, points[k].data[m][1], "#00558e")
                    }

                }
            }
        }

    });
    function showTooltip(x, y, contents, colour) {
        $('<div id="value">' + contents + " ℃" + '</div>').css({
            position: 'absolute',
            display: 'none',
            top: y,
            left: x,
            'border-style': 'solid',
            'border-width': '2px',
            'border-color': "#FFF",
            'border-radius': '5px',
            'background-color': colour,
            color: '#FFF',
            padding: '2px'
        }).appendTo("body").fadeIn(200);
    } 
    
</script>